<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Innovators: Tetris Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: linear-gradient(to right top, #00c9a7, #00bca8, #00afa6, #00a1a2, #00949c);
        }
        .container {
            text-align: center;
            padding: 20px;
            border-radius: 20px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #main-menu, #player-selection, #role-selection, #game-container, #score-page {
            display: none;
        }
        #main-menu {
            display: block;
        }
        #tetris-board {
            background-color: #000;
            width: 200px;
            height: 400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(10, 20px);
            grid-template-rows: repeat(20, 20px);
            gap: 0px;
            border: 2px solid #333; /* 为整个游戏区域添加边框 */
            float: left;
        }
        .cell {
            width: 20px;
            height: 20px;
            background-color: #333;
            border: 1px solid #333; /* 为每个单元格添加边框 */
            box-sizing: border-box;
            border-radius: 5px;
        }
        .active {
            background-color: #00f;
        }
        #scoreboard {
            width: 150px;
            float: left;
            margin-left: 20px;
        }
        .button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #45a049;
        }
        .hidden {
            display: none;
        }
        #question-area {
            margin-top: 20px;
            display: none;
            text-align: left;
            border-radius: 15px;
            background-color: #f0f0f0;
            padding: 15px;
        }
        #question-text {
            margin-bottom: 10px;
        }
        #decision-feedback {
            margin-top: 10px;
            color: green;
        }
        /* 移除最右侧单元格的右边框 */
        .cell:nth-child(10n) {
            border-right: none;
        }

        /* 移除最底部单元格的底边框 */
        .cell:nth-child(n+191):nth-child(-n+200) {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <div id="main-menu" class="container">
        <h1>AI Innovators</h1>
        <p>The use of AI in the K-12 education system is increasing rapidly. This game allows you to explore the pluses and minuses of regulation and free innovation in the field.</p>
        <button class="button" onclick="startPlayerSelection()">Start Game</button>
    </div>

    <!-- Player Selection -->
    <div id="player-selection" class="container">
        <h2>Select Number of Players</h2>
        <button class="button" onclick="selectPlayers(1)">1 Player</button>
        <button class="button" onclick="selectPlayers(2)">2 Players</button>
    </div>

    <!-- Role Selection -->
    <div id="role-selection" class="container">
        <h2>Select Role(s)</h2>
        <div id="player-1-role">
            <h3>Player 1, select your role</h3>
            <button class="button" onclick="selectRole(1, 'Technologist')">Technologist</button>
            <button class="button" onclick="selectRole(1, 'Ethics Advisor')">Ethics Advisor</button>
            <button class="button" onclick="selectRole(1, 'Principal')">Principal</button>
        </div>
        <div id="player-2-role" class="hidden">
            <h3>Player 2, select your role</h3>
            <button class="button" onclick="selectRole(2, 'Technologist')">Technologist</button>
            <button class="button" onclick="selectRole(2, 'Ethics Advisor')">Ethics Advisor</button>
            <button class="button" onclick="selectRole(2, 'Principal')">Principal</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container" class="container">
        <div id="tetris-board"></div>
        <div id="scoreboard">
            <h3>Next Block:</h3>
            <div id="next-block"></div>
            <h3>Scores:</h3>
            <div id="score-player-1">Player 1: 0</div>
            <div id="score-player-2" class="hidden">Player 2: 0</div>
        </div>
    </div>

    <!-- Score Page -->
    <div id="score-page" class="container">
        <h2>Game Over</h2>
        <p id="final-scores"></p>
        <button class="button" onclick="replayGame()">Replay</button>
    </div>

    <div id="question-area" style="display: none;">
        <div id="question-text"></div>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
    </div>

    <script>
        // Variables
        let playerCount = 1;
        let currentPlayer = 1;
        let roles = [];
        let scores = [0, 0];
        let dropCounter = 0;
        let gamePaused = false;
        let currentShape, nextShape, currentPosition, dropSpeed = 1000;
        let tetrisGrid = [];
        let gameInterval;
        const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];
        const shapes = [
            [[1, 1, 1, 1]], // I
            [[1, 1], [1, 1]], // O
            [[1, 1, 1], [0, 1, 0]], // T
            [[1, 1, 0], [0, 1, 1]], // Z
            [[0, 1, 1], [1, 1, 0]], // S
            [[1, 1, 1], [1, 0, 0]], // L
            [[1, 1, 1], [0, 0, 1]]  // J
        ];

        // 在全局范围内声明变量
        let blockCount = 0;
        let rowsClearedSinceLastQuestion = 0;
        let questionQueue = [];

        const BOARD_HEIGHT = 20;
        const BOARD_WIDTH = 10;

        let technologistQuestions = [
    [ // Level 1
        {
            question: "What is AI?",
            options: ["A) A system that learns and makes decisions", "B) A physical machine", "C) A human-controlled robot", "D) A mathematical tool"],
            answer: "A) A system that learns and makes decisions"
        },
        {
            question: "Which of the following is NOT an AI application?",
            options: ["A) Facial recognition", "B) Self-driving cars", "C) Microwave ovens", "D) Speech recognition"],
            answer: "C) Microwave ovens"
        },
        {
            question: "Which of these terms is related to AI?",
            options: ["A) Neural Networks", "B) Gravity", "C) Photosynthesis", "D) Erosion"],
            answer: "A) Neural Networks"
        },
        {
            question: "What is machine learning in AI?",
            options: ["A) Teaching machines how to speak", "B) Giving machines data to learn patterns", "C) Robots cleaning houses", "D) Robots understanding emotions"],
            answer: "B) Giving machines data to learn patterns"
        },
        {
            question: "Which of these is an ethical concern for AI?",
            options: ["A) AI making biased decisions", "B) AI cooking meals", "C) AI driving bicycles", "D) AI helping humans exercise"],
            answer: "A) AI making biased decisions"
        },
        {
            question: "What is a chatbot?",
            options: ["A) A virtual assistant using AI to talk with humans", "B) A real robot that walks around", "C) A smart car system", "D) A computer game character"],
            answer: "A) A virtual assistant using AI to talk with humans"
        },
        {
            question: "What is AI's primary goal?",
            options: ["A) To simulate human intelligence", "B) To replace all human jobs", "C) To make physical robots", "D) To control other machines"],
            answer: "A) To simulate human intelligence"
        },
        {
            question: "Which of the following can AI NOT do?",
            options: ["A) Think like a human", "B) Process large amounts of data", "C) Recognize images", "D) Understand languages"],
            answer: "A) Think like a human"
        },
        {
            question: "Which of the following is a benefit of AI in schools?",
            options: ["A) Personalized learning experiences", "B) Making teachers obsolete", "C) Monitoring students 24/7", "D) Replacing all textbooks with robots"],
            answer: "A) Personalized learning experiences"
        },
        {
            question: "What does AI stand for?",
            options: ["A) Artificial Intelligence", "B) Advanced Innovation", "C) Automated Interface", "D) Advanced Information"],
            answer: "A) Artificial Intelligence"
        }
    ],
    [ // Level 2
        {
            question: "Why should schools consider AI policies?",
            options: ["A) To manage AI's ethical implications", "B) To prevent the use of technology", "C) To ensure AI replaces all teachers", "D) To integrate AI in sports"],
            answer: "A) To manage AI's ethical implications"
        },
        {
            question: "Who should oversee AI use in schools?",
            options: ["A) Government regulators", "B) Students", "C) AI companies", "D) Nobody, AI is self-managing"],
            answer: "A) Government regulators"
        },
        {
            question: "What is one challenge of regulating AI in education?",
            options: ["A) Balancing privacy concerns", "B) Teaching AI to cook food", "C) Getting students to use AI", "D) Making AI control all classes"],
            answer: "A) Balancing privacy concerns"
        },
        {
            question: "Why is transparency important in AI policy?",
            options: ["A) To show how AI makes decisions", "B) To allow AI to hide mistakes", "C) To let AI operate in secrecy", "D) To let AI manage policies alone"],
            answer: "A) To show how AI makes decisions"
        },
        {
            question: "What should AI policies in schools aim to protect?",
            options: ["A) Student data privacy", "B) AI's autonomy", "C) School budgets", "D) Teacher salaries"],
            answer: "A) Student data privacy"
        },
        {
            question: "What is a potential risk of AI in schools?",
            options: ["A) AI making biased decisions about students", "B) AI improving student grades too quickly", "C) AI teaching incorrect material", "D) AI becoming too smart for teachers"],
            answer: "A) AI making biased decisions about students"
        },
        {
            question: "How should schools approach AI adoption?",
            options: ["A) With cautious regulation", "B) By immediately adopting all AI tools", "C) By leaving AI unregulated", "D) By replacing teachers with AI"],
            answer: "A) With cautious regulation"
        },
        {
            question: "Which of these is part of a good AI policy for schools?",
            options: ["A) Privacy and data protection", "B) Unlimited AI access to student information", "C) Using AI to replace all school subjects", "D) Letting AI operate without teacher oversight"],
            answer: "A) Privacy and data protection"
        },
        {
            question: "Who benefits from ethical AI policies in schools?",
            options: ["A) Both students and teachers", "B) Only AI developers", "C) Only the school administration", "D) Nobody, AI doesn't need regulation"],
            answer: "A) Both students and teachers"
        },
        {
            question: "What role should teachers have in AI policy development?",
            options: ["A) Involved in shaping AI tools and regulations", "B) Fully replaced by AI", "C) Excluded from AI discussions", "D) Only monitoring AI outcomes"],
            answer: "A) Involved in shaping AI tools and regulations"
        }
    ],
    [ // Level 3
        {
            question: "How can schools balance AI innovation and regulation?",
            options: ["A) By encouraging responsible AI development", "B) By completely banning AI", "C) By letting AI control all classrooms", "D) By removing all regulation"],
            answer: "A) By encouraging responsible AI development"
        },
        {
            question: "Why is it important to regulate AI in education?",
            options: ["A) To prevent bias and protect student rights", "B) To slow down technological progress", "C) To replace human teachers", "D) To teach AI how to think"],
            answer: "A) To prevent bias and protect student rights"
        },
        {
            question: "What is one challenge of promoting AI innovation in schools?",
            options: ["A) Ensuring AI use doesn't violate privacy", "B) Getting students to understand math better", "C) Replacing all textbooks with AI", "D) Making AI the principal"],
            answer: "A) Ensuring AI use doesn't violate privacy"
        },
        {
            question: "What is the main goal of AI regulation in schools?",
            options: ["A) To protect students and ensure fair outcomes", "B) To increase teacher workload", "C) To make AI grade students faster", "D) To slow AI development"],
            answer: "A) To protect students and ensure fair outcomes"
        },
        {
            question: "Which of the following ensures AI innovation?",
            options: ["A) Encouraging ethical AI use", "B) Removing all human oversight", "C) Replacing students with AI", "D) Letting AI control school policies"],
            answer: "A) Encouraging ethical AI use"
        },
        {
            question: "How should schools ensure AI innovation?",
            options: ["A) By creating a balance between creative AI tools and ethical guidelines", "B) By allowing AI to operate without any rules", "C) By leaving all innovation to AI developers", "D) By allowing AI to replace human decision-making"],
            answer: "A) By creating a balance between creative AI tools and ethical guidelines"
        },
        {
            question: "What should be prioritized in AI innovation?",
            options: ["A) Ethical and responsible development", "B) Faster grading systems", "C) Replacing human jobs", "D) Minimizing teacher input"],
            answer: "A) Ethical and responsible development"
        },
        {
            question: "Why is innovation important in AI?",
            options: ["A) To continually improve learning tools and experiences", "B) To slow down technology in schools", "C) To replace students with AI", "D) To stop teachers from working"],
            answer: "A) To continually improve learning tools and experiences"
        },
        {
            question: "What is the role of ethics in AI innovation?",
            options: ["A) Ensuring AI operates fairly and transparently", "B) Allowing AI to control all school decisions", "C) Ignoring ethics to speed up innovation", "D) Letting AI manage student data without oversight"],
            answer: "A) Ensuring AI operates fairly and transparently"
        },
        {
            question: "How can schools promote ethical AI innovation?",
            options: ["A) By developing policies that balance creativity and student protection", "B) By allowing AI developers to make all decisions", "C) By leaving ethics out of AI development", "D) By minimizing human input into AI systems"],
            answer: "A) By developing policies that balance creativity and student protection"
                }
            ]
        ];

        let ethicsAdvisorQuestions = [
            [ // Level 1
                {
                    question: "What does \"ethics\" in AI refer to?",
                    options: ["A) Teaching AI to be moral", "B) Ensuring AI is used responsibly in society", "C) Programming emotions into AI", "D) Making AI independent of humans"],
                    answer: "B) Ensuring AI is used responsibly in society"
                },
                {
                    question: "What is one concern regarding AI in education?",
                    options: ["A) AI becoming too smart", "B) AI replacing all teachers", "C) AI making biased decisions about students", "D) AI teaching itself"],
                    answer: "C) AI making biased decisions about students"
                },
                {
                    question: "What is a key principle in AI ethics?",
                    options: ["A) Fairness", "B) Speed", "C) Accuracy", "D) Profit"],
                    answer: "A) Fairness"
                },
                {
                    question: "Which of the following is NOT an ethical issue related to AI?",
                    options: ["A) Data privacy", "B) Algorithm bias", "C) AI processing speed", "D) Accountability in decision-making"],
                    answer: "C) AI processing speed"
                },
                {
                    question: "What is algorithmic bias in AI?",
                    options: ["A) A systematic error that leads to unfair outcomes", "B) AI learning too fast", "C) AI refusing to follow human commands", "D) A technical malfunction"],
                    answer: "A) A systematic error that leads to unfair outcomes"
                },
                {
                    question: "How can we ensure AI makes fair decisions?",
                    options: ["A) By ensuring diverse and inclusive data is used", "B) By letting AI develop its own ethics", "C) By removing human oversight", "D) By using AI in only some industries"],
                    answer: "A) By ensuring diverse and inclusive data is used"
                },
                {
                    question: "Why is transparency important in AI systems?",
                    options: ["A) It helps people understand how decisions are made", "B) It speeds up the AI's processing", "C) It allows AI to work in secret", "D) It hides AI's weaknesses from the public"],
                    answer: "A) It helps people understand how decisions are made"
                },
                {
                    question: "What does \"privacy\" mean in AI ethics?",
                    options: ["A) Protecting individual data from misuse", "B) Allowing AI to gather as much data as possible", "C) Hiding AI's decisions from humans", "D) Allowing AI to work without human interference"],
                    answer: "A) Protecting individual data from misuse"
                },
                {
                    question: "Which of these is a risk of using AI in schools?",
                    options: ["A) AI making wrong decisions due to bias", "B) AI improving learning experiences", "C) AI grading students too quickly", "D) AI teaching multiple subjects at once"],
                    answer: "A) AI making wrong decisions due to bias"
                },
                {
                    question: "How should schools ensure AI is used ethically?",
                    options: ["A) By creating clear policies on its use", "B) By leaving decisions to AI developers", "C) By allowing AI to self-regulate", "D) By banning AI entirely"],
                    answer: "A) By creating clear policies on its use"
                }
            ],
            [ // Level 2
                {
                    question: "What is one way to ensure AI in schools is used ethically?",
                    options: ["A) Creating ethical guidelines for AI use", "B) Allowing AI to run without human oversight", "C) Replacing teachers with AI", "D) Giving AI access to all student data"],
                    answer: "A) Creating ethical guidelines for AI use"
                },
                {
                    question: "Who should be responsible for AI policy in schools?",
                    options: ["A) Only government regulators", "B) A collaboration between educators, policymakers, and technologists", "C) Only AI developers", "D) Students"],
                    answer: "B) A collaboration between educators, policymakers, and technologists"
                },
                {
                    question: "Why is data privacy important in AI ethics?",
                    options: ["A) To protect individuals' personal information from misuse", "B) To make AI systems work faster", "C) To allow AI to collect more data", "D) To help AI run without human input"],
                    answer: "A) To protect individuals' personal information from misuse"
                },
                {
                    question: "What is a key challenge in AI policy development?",
                    options: ["A) Balancing innovation and privacy", "B) Making AI work independently of humans", "C) Replacing human teachers with AI", "D) Making AI policies simple and universal"],
                    answer: "A) Balancing innovation and privacy"
                },
                {
                    question: "Why should schools involve parents in AI policy discussions?",
                    options: ["A) Parents can help protect their children's privacy and data", "B) Parents know the most about AI technology", "C) Parents will use AI to help grade students", "D) Parents should be the ones developing AI systems"],
                    answer: "A) Parents can help protect their children's privacy and data"
                },
                {
                    question: "Which of the following is a critical element of AI policy?",
                    options: ["A) Ensuring transparency in AI decisions", "B) Making AI operate without human intervention", "C) Allowing AI to control the entire school system", "D) Giving AI full access to student grades"],
                    answer: "A) Ensuring transparency in AI decisions"
                },
                {
                    question: "What is a possible consequence of poor AI regulation?",
                    options: ["A) AI making biased or unfair decisions", "B) AI becoming too slow", "C) AI failing to recognize students", "D) AI not working well with humans"],
                    answer: "A) AI making biased or unfair decisions"
                },
                {
                    question: "What role should teachers play in AI policy?",
                    options: ["A) Actively participating in shaping AI's role in the classroom", "B) Allowing AI to manage student performance", "C) Letting AI decide their teaching style", "D) Replacing their teaching role with AI"],
                    answer: "A) Actively participating in shaping AI's role in the classroom"
                },
                {
                    question: "Why should AI policies include guidelines on bias?",
                    options: ["A) To prevent AI from making unfair decisions", "B) To make AI operate faster", "C) To allow AI to collect more data", "D) To prevent AI from failing"],
                    answer: "A) To prevent AI from making unfair decisions"
                },
                {
                    question: "What is one benefit of ethical AI policies?",
                    options: ["A) They protect student rights while encouraging innovation", "B) They allow AI to replace human teachers", "C) They help AI become more powerful", "D) They make AI decisions less transparent"],
                    answer: "A) They protect student rights while encouraging innovation"
                }
            ],
            [ // Level 3
                {
                    question: "What is the goal of balancing AI innovation with regulation?",
                    options: ["A) To ensure AI benefits everyone while protecting ethical standards", "B) To completely restrict AI use in schools", "C) To let AI operate without human oversight", "D) To make AI responsible for all school decisions"],
                    answer: "A) To ensure AI benefits everyone while protecting ethical standards"
                },
                {
                    question: "Why is innovation important in AI ethics?",
                    options: ["A) It allows AI to develop solutions to real-world problems", "B) It makes AI more expensive", "C) It reduces the need for ethical policies", "D) It replaces human decision-making"],
                    answer: "A) It allows AI to develop solutions to real-world problems"
                },
                {
                    question: "What is a potential risk of too much AI regulation?",
                    options: ["A) Slowing down technological progress", "B) Allowing AI to take control", "C) AI becoming unethical", "D) AI failing to follow instructions"],
                    answer: "A) Slowing down technological progress"
                },
                {
                    question: "How can schools promote AI innovation ethically?",
                    options: ["A) By creating policies that encourage ethical experimentation with AI", "B) By removing human input from AI development", "C) By giving AI full control over learning", "D) By allowing AI to gather unlimited data"],
                    answer: "A) By creating policies that encourage ethical experimentation with AI"
                },
                {
                    question: "What is a key challenge in balancing AI innovation with regulation?",
                    options: ["A) Ensuring innovation does not compromise privacy", "B) Making AI responsible for policy decisions", "C) Replacing human teachers with AI", "D) Allowing AI to make its own rules"],
                    answer: "A) Ensuring innovation does not compromise privacy"
                },
                {
                    question: "Why is transparency important in balancing AI regulation and innovation?",
                    options: ["A) It ensures that AI decisions are fair and accountable", "B) It hides AI's processes from the public", "C) It allows AI to work without human interference", "D) It speeds up AI development"],
                    answer: "A) It ensures that AI decisions are fair and accountable"
                },
                {
                    question: "What should schools avoid when promoting AI innovation?",
                    options: ["A) Ignoring the ethical implications of AI", "B) Encouraging student input", "C) Using AI in classrooms", "D) Discussing AI with policymakers"],
                    answer: "A) Ignoring the ethical implications of AI"
                },
                {
                    question: "What is one way to ensure ethical AI innovation in schools?",
                    options: ["A) Regularly updating AI policies to keep up with innovation", "B) Letting AI operate without policies", "C) Allowing AI to make policy decisions", "D) Avoiding innovation altogether"],
                    answer: "A) Regularly updating AI policies to keep up with innovation"
                },
                {
                    question: "What role do teachers have in balancing AI innovation?",
                    options: ["A) Helping integrate new AI tools responsibly", "B) Letting AI take over their jobs", "C) Avoiding involvement in AI development", "D) Allowing AI to set classroom rules"],
                    answer: "A) Helping integrate new AI tools responsibly"
                },
                {
                    question: "Why is it important to balance innovation with ethical guidelines?",
                    options: ["A) To ensure AI develops responsibly and doesn't harm students", "B) To make AI faster", "C) To replace human teachers", "D) To allow AI to collect as much data as possible"],
                    answer: "A) To ensure AI develops responsibly and doesn't harm students"
                }
            ]
        ];

        let principalQuestions = [
            [ // Level 1
                {
                    question: "What is the role of a school principal in AI adoption?",
                    options: ["A) Ensuring AI use aligns with school goals and policies", "B) Teaching AI to students directly", "C) Programming AI tools for teachers", "D) Allowing AI to manage the school"],
                    answer: "A) Ensuring AI use aligns with school goals and policies"
                },
                {
                    question: "Why is AI becoming important in schools?",
                    options: ["A) It personalizes learning for students", "B) It replaces human teachers entirely", "C) It makes all school decisions", "D) It teaches students ethics directly"],
                    answer: "A) It personalizes learning for students"
                },
                {
                    question: "What is a primary ethical concern when using AI in schools?",
                    options: ["A) Data privacy for students", "B) AI grading too quickly", "C) AI teaching physical education", "D) AI replacing homework"],
                    answer: "A) Data privacy for students"
                },
                {
                    question: "Which of the following is an example of AI used in schools?",
                    options: ["A) Personalized learning systems", "B) AI-powered cafeterias", "C) Robot janitors", "D) Automated playgrounds"],
                    answer: "A) Personalized learning systems"
                },
                {
                    question: "What is one benefit of AI in education?",
                    options: ["A) Helping teachers personalize lessons for students", "B) Replacing teachers in classrooms", "C) Grading all students without human input", "D) Taking over school management"],
                    answer: "A) Helping teachers personalize lessons for students"
                },
                {
                    question: "What should principals consider when adopting AI?",
                    options: ["A) How AI aligns with educational goals and ethical standards", "B) How quickly AI can replace teachers", "C) How AI can run the school autonomously", "D) How to use AI to replace textbooks"],
                    answer: "A) How AI aligns with educational goals and ethical standards"
                },
                {
                    question: "Which of these is NOT a benefit of AI in schools?",
                    options: ["A) Improving personalized education", "B) Enhancing data privacy", "C) Teaching ethics directly", "D) Automating decision-making"],
                    answer: "D) Automating decision-making"
                },
                {
                    question: "What is the responsibility of a principal regarding AI ethics?",
                    options: ["A) Ensuring AI follows ethical guidelines and doesn't harm students", "B) Letting AI create its own ethics policies", "C) Giving AI full control of student management", "D) Letting AI replace human oversight"],
                    answer: "A) Ensuring AI follows ethical guidelines and doesn't harm students"
                },
                {
                    question: "Which of the following is an ethical risk in using AI?",
                    options: ["A) Biased decisions affecting student outcomes", "B) AI enhancing student understanding", "C) AI grading homework faster", "D) AI assisting teachers with lessons"],
                    answer: "A) Biased decisions affecting student outcomes"
                },
                {
                    question: "How should principals balance AI and human oversight?",
                    options: ["A) By integrating AI while ensuring human teachers make final decisions", "B) By giving AI full control", "C) By removing human oversight entirely", "D) By using AI for every classroom task"],
                    answer: "A) By integrating AI while ensuring human teachers make final decisions"
                }
            ],
            [ // Level 2
                {
                    question: "What is one key concern in AI policy for schools?",
                    options: ["A) Protecting student data and privacy", "B) Making AI the primary decision-maker", "C) Removing teachers from classrooms", "D) Allowing students to write AI policies"],
                    answer: "A) Protecting student data and privacy"
                },
                {
                    question: "What should AI policies focus on?",
                    options: ["A) Ethical use of AI in education", "B) Allowing AI to run without rules", "C) Giving AI access to all data", "D) Replacing teachers with AI"],
                    answer: "A) Ethical use of AI in education"
                },
                {
                    question: "Who should be involved in AI policy discussions in schools?",
                    options: ["A) Teachers, policymakers, and AI experts", "B) Only students", "C) Only AI developers", "D) Only principals"],
                    answer: "A) Teachers, policymakers, and AI experts"
                },
                {
                    question: "What is one challenge in developing AI policies?",
                    options: ["A) Balancing innovation with student protection", "B) Allowing AI to operate independently", "C) Replacing all human jobs with AI", "D) Teaching students to program AI"],
                    answer: "A) Balancing innovation with student protection"
                },
                {
                    question: "Why is it important to include ethical guidelines in AI policies?",
                    options: ["A) To ensure AI use doesn't harm students", "B) To speed up AI adoption", "C) To make AI more powerful", "D) To reduce the number of teachers"],
                    answer: "A) To ensure AI use doesn't harm students"
                },
                {
                    question: "What is a benefit of clear AI policies in schools?",
                    options: ["A) Ensuring fairness and transparency in AI decisions", "B) Allowing AI to collect unlimited data", "C) Reducing the role of teachers", "D) Giving AI full control over students"],
                    answer: "A) Ensuring fairness and transparency in AI decisions"
                },
                {
                    question: "How can AI policies protect student privacy?",
                    options: ["A) By limiting the data AI can access", "B) By giving AI access to all personal data", "C) By removing human oversight", "D) By making AI invisible"],
                    answer: "A) By limiting the data AI can access"
                },
                {
                    question: "What should principals ensure when adopting AI?",
                    options: ["A) That AI aligns with both educational goals and privacy protections", "B) That AI replaces human staff", "C) That AI operates without policies", "D) That AI is used for every classroom task"],
                    answer: "A) That AI aligns with both educational goals and privacy protections"
                },
                {
                    question: "What is one way to ensure ethical AI use in schools?",
                    options: ["A) By developing policies that focus on fairness and transparency", "B) By giving AI full control over student data", "C) By letting AI decide policies on its own", "D) By allowing AI to bypass regulations"],
                    answer: "A) By developing policies that focus on fairness and transparency"
        },
        {
                    question: "How can schools balance innovation with ethical AI policies?",
                    options: ["A) By allowing AI experimentation within ethical boundaries", "B) By giving AI full autonomy", "C) By limiting AI use in education", "D) By letting students write the AI policies"],
                    answer: "A) By allowing AI experimentation within ethical boundaries"
                }
    ],
            [ // Level 3
                {
                    question: "What is the role of the principal in balancing AI innovation and regulation?",
                    options: ["A) Ensuring that AI innovation is aligned with ethical standards and educational goals", "B) Giving AI full control over all decisions", "C) Allowing AI to operate without rules", "D) Ensuring AI replaces teachers"],
                    answer: "A) Ensuring that AI innovation is aligned with ethical standards and educational goals"
                },
                {
                    question: "Why is regulation important in AI innovation?",
                    options: ["A) To protect students and ensure fair outcomes", "B) To slow down AI progress", "C) To reduce the need for teachers", "D) To allow AI to make its own rules"],
                    answer: "A) To protect students and ensure fair outcomes"
                },
                {
                    question: "What is a potential risk of too much AI regulation?",
                    options: ["A) Stifling innovation and slowing progress", "B) Allowing AI to take over education", "C) AI making unethical decisions", "D) Teachers relying too much on AI"],
                    answer: "A) Stifling innovation and slowing progress"
                },
                {
                    question: "How can principals promote innovation while maintaining ethical standards?",
                    options: ["A) By developing policies that support responsible AI experimentation", "B) By allowing AI to operate without restrictions", "C) By letting AI decide its own policies", "D) By limiting the role of teachers"],
                    answer: "A) By developing policies that support responsible AI experimentation"
                },
                {
                    question: "What is a key challenge in balancing innovation and regulation in schools?",
                    options: ["A) Ensuring student privacy while encouraging AI use", "B) Allowing AI to fully control student outcomes", "C) Removing all ethical guidelines", "D) Limiting the role of teachers in AI policy"],
                    answer: "A) Ensuring student privacy while encouraging AI use"
                },
                {
                    question: "Why should schools regularly update AI policies?",
                    options: ["A) To keep up with technological advancements while protecting student interests", "B) To give AI more control over school management", "C) To reduce the number of teachers", "D) To eliminate all human oversight"],
                    answer: "A) To keep up with technological advancements while protecting student interests"
                },
                {
                    question: "What should schools avoid when promoting AI innovation?",
                    options: ["A) Ignoring the ethical implications of AI use", "B) Encouraging teacher input", "C) Using AI to enhance student learning", "D) Allowing AI to manage student data"],
                    answer: "A) Ignoring the ethical implications of AI use"
                },
                {
                    question: "What is one way to ensure ethical AI innovation in schools?",
                    options: ["A) Developing clear policies that balance creativity and privacy protection", "B) Allowing AI to operate without human input", "C) Replacing human oversight with AI decision-making", "D) Giving AI control over policy development"],
                    answer: "A) Developing clear policies that balance creativity and privacy protection"
                },
                {
                    question: "What is the role of teachers in balancing AI innovation?",
                    options: ["A) Helping integrate AI tools responsibly while ensuring ethical use", "B) Allowing AI to replace their role in classrooms", "C) Staying uninvolved in AI policy discussions", "D) Letting AI manage student data without oversight"],
                    answer: "A) Helping integrate AI tools responsibly while ensuring ethical use"
                },
                {
                    question: "Why is it important to balance AI innovation with ethical guidelines?",
                    options: ["A) To ensure AI doesn't harm students or compromise privacy", "B) To allow AI to make decisions faster", "C) To reduce the number of teachers in schools", "D) To give AI full autonomy over learning decisions"],
                    answer: "A) To ensure AI doesn't harm students or compromise privacy"
                }
            ]
        ];

        let questionTimer;
        let currentQuestionStartTime;

        // 在全局范围内添加这些变量
        let askedQuestions = new Set();
        let currentLevel = 1;

        let lastQuestionTime = 0;
        const QUESTION_INTERVAL = 30000; // 30秒，您可以根据需要调整这个值

        // Start Player Selection
        function startPlayerSelection() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('player-selection').style.display = 'block';
        }

        // Select Number of Players
        function selectPlayers(count) {
            playerCount = count;
            document.getElementById('player-selection').style.display = 'none';
            document.getElementById('role-selection').style.display = 'block';
            if (playerCount === 1) {
                document.getElementById('player-2-role').style.display = 'none';
            } else {
                document.getElementById('player-2-role').style.display = 'block';
            }
        }

        // Select Role
        function selectRole(player, role) {
            roles[player - 1] = role;
            if (player === 1 && playerCount === 2) {
                document.getElementById('player-1-role').style.display = 'none';
                document.getElementById('player-2-role').style.display = 'block';
            } else {
                startGame();
            }
        }

        // Start Game
        function startGame() {
            document.getElementById('role-selection').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            if (playerCount === 2) {
                document.getElementById('score-player-2').style.display = 'block';
            }
            initializeBoard();
            generateNewShape();
            dropCounter = 0;  // 初始化 dropCounter
            gameInterval = setInterval(dropShape, dropSpeed);  // Start game loop
            blockCount = 0;
            rowsClearedSinceLastQuestion = 0;
            questionQueue = [];
        }

        // Initialize Tetris Board
        function initializeBoard() {
            tetrisGrid = [];
            for (let row = 0; row < BOARD_HEIGHT; row++) {
                tetrisGrid.push(new Array(BOARD_WIDTH).fill(0));  // 10 columns by 20 rows
            }
            renderBoard();
        }

        // Render Tetris Board
        function renderBoard() {
            const tetrisBoard = document.getElementById('tetris-board');
            tetrisBoard.innerHTML = '';
            for (let row = 0; row < BOARD_HEIGHT; row++) {
                for (let col = 0; col < BOARD_WIDTH; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (tetrisGrid[row][col] === 1) {
                        cell.classList.add('active');
                        cell.style.backgroundColor = '#FFFFFF'; // 已固定的方块颜色
                    } else if (tetrisGrid[row][col] === 2) {
                        cell.classList.add('active');
                        cell.style.backgroundColor = '#FFFFFF'; // 活动方块颜色
                    }
                    tetrisBoard.appendChild(cell);
                }
            }
        }

        // Generate a new shape
        function generateNewShape() {
            currentShape = nextShape || shapes[Math.floor(Math.random() * shapes.length)];
            nextShape = shapes[Math.floor(Math.random() * shapes.length)];
            currentColor = colors[Math.floor(Math.random() * colors.length)];
            currentPosition = { x: 3, y: 0 };  // Start position
            drawShape();
            renderNextBlock();
            renderBoard();
            
            blockCount++;
            console.log("Block count:", blockCount);
            
            if (blockCount % 10 === 0) {
                questionQueue.push("block");
            }
            
            checkAndTriggerQuestion();
        }

        // Draw shape on the board
        function drawShape() {
            for (let row = 0; row < currentShape.length; row++) {
                for (let col = 0; col < currentShape[row].length; col++) {
                    if (currentShape[row][col] === 1) {
                        tetrisGrid[currentPosition.y + row][currentPosition.x + col] = 2; // 使用2表示活动方块
                    }
                }
            }
        }

        // Render the next block in the scoreboard
        function renderNextBlock() {
            const nextBlock = document.getElementById('next-block');
            nextBlock.innerHTML = '';  // Clear previous block
            nextShape.forEach(row => {
                let rowDiv = document.createElement('div');
                row.forEach(cell => {
                    let block = document.createElement('span');
                    block.style.display = 'inline-block';
                    block.style.width = '20px';
                    block.style.height = '20px';
                    block.style.margin = '1px';
                    block.style.backgroundColor = cell === 1 ? currentColor : 'transparent';
                    rowDiv.appendChild(block);
                });
                nextBlock.appendChild(rowDiv);
            });
        }

        // Clear shape from the board
        function clearShape() {
            for (let row = 0; row < currentShape.length; row++) {
                for (let col = 0; col < currentShape[row].length; col++) {
                    if (currentShape[row][col] === 1) {
                        tetrisGrid[currentPosition.y + row][currentPosition.x + col] = 0;
                    }
                }
            }
        }

        // Drop shape
        function dropShape() {
            if (gamePaused) return;
            clearShape();
            currentPosition.y += 1;
            if (checkCollision()) {
                currentPosition.y -= 1;
                placeShape();
                
                let rowsCleared = checkRows();
                
                if (currentPosition.y === 0) {
                    endGame();
                    return;
                }

                // 更新方块数量计数
                blockCount++;
                console.log("Block count:", blockCount);
                
                // 检查是否应该触发问题
                let currentTime = Date.now();
                if (currentTime - lastQuestionTime > QUESTION_INTERVAL &&
                    (blockCount % 10 === 0 || rowsCleared > 0 || 
                    scores[currentPlayer - 1] >= 100 || scores[currentPlayer - 1] >= 200)) {
                    shouldTriggerQuestion = true;
                    lastQuestionTime = currentTime;
                }
                
                if (shouldTriggerQuestion) {
                    triggerQuestion();
                } else {
                    generateNewShape();
                }
            } else {
                drawShape();
                renderBoard();
            }
        }

        // Place shape on the board
        function placeShape() {
            for (let row = 0; row < currentShape.length; row++) {
                for (let col = 0; col < currentShape[row].length; col++) {
                    if (currentShape[row][col] === 1) {
                        tetrisGrid[currentPosition.y + row][currentPosition.x + col] = 1; // 用1表示固定方块
                    }
                }
            }
        }

        // Check for collisions
        function checkCollision() {
            for (let row = 0; row < currentShape.length; row++) {
                for (let col = 0; col < currentShape[row].length; col++) {
                    if (
                        currentShape[row][col] === 1 &&
                        (currentPosition.y + row >= BOARD_HEIGHT || currentPosition.x + col >= BOARD_WIDTH || currentPosition.x + col < 0 || tetrisGrid[currentPosition.y + row][currentPosition.x + col] === 1)
                    ) {
                        return true;
                    }
                }
            }
            return false;
        }

        // Check and remove full rows
        function checkRows() {
            let rowsCleared = 0;
            for (let row = BOARD_HEIGHT - 1; row >= 0; row--) {
                if (tetrisGrid[row].every(cell => cell !== 0)) {
                    rowsCleared++;
                    
                    // 从当前行开始，将上面的所有行向下移动一行
                    for (let y = row; y > 0; y--) {
                        tetrisGrid[y] = [...tetrisGrid[y-1]];
                    }
                    
                    // 在顶部添加一个新的空行
                    tetrisGrid[0] = new Array(BOARD_WIDTH).fill(0);
                    
                    // 不需要增加 row，因为我们要继续检查当前行（现在包含了之前的上一行）
                }
            }
            
            if (rowsCleared > 0) {
                updateScore(rowsCleared);
                renderBoard();  // 确保在消行后重新渲染游戏板
            }
            
            return rowsCleared;
        }

        // Update scores
        function updateScore(rowsCleared) {
            const scoreIncrement = [0, 10, 20, 30, 40][rowsCleared];  // 0, 1, 2, 3, 4 行的得分
            scores[currentPlayer - 1] += scoreIncrement;
            document.getElementById(`score-player-${currentPlayer}`).textContent = `玩家 ${currentPlayer}: ${scores[currentPlayer - 1]}`;
        }

        // End the game and show final scores
        function endGame() {
            clearInterval(gameInterval);
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('score-page').style.display = 'block';
            document.getElementById('final-scores').innerText = `Final Scores:\nPlayer 1: ${scores[0]}${playerCount === 2 ? `\nPlayer 2: ${scores[1]}` : ''}`;
        }

        // Replay game
        function replayGame() {
            document.getElementById('score-page').style.display = 'none';
            document.getElementById('main-menu').style.display = 'block';
            scores = [0, 0];  // Reset scores
            clearInterval(gameInterval);
        }

        // Keyboard controls
        document.addEventListener('keydown', (event) => {
            if (gamePaused) return;

            if (event.key === 'A' || event.key === 'a') {
                clearShape();
                currentPosition.x -= 1;
                if (checkCollision()) {
                    currentPosition.x += 1;
                }
                drawShape();
                renderBoard();
            } else if (event.key === 'D' || event.key === 'd') {
                clearShape();
                currentPosition.x += 1;
                if (checkCollision()) {
                    currentPosition.x -= 1;
                }
                drawShape();
                renderBoard();
            } else if (event.key === 'W' || event.key === 'w') {
                clearShape();
                rotateShape();
                if (checkCollision()) {
                    rotateShape(false);  // Rotate back if collision occurs
                }
                drawShape();
                renderBoard();
            } else if (event.key === 'S' || event.key === 's') {
                clearShape();
                currentPosition.y += 1;
                if (checkCollision()) {
                    currentPosition.y -= 1;
                    placeShape();
                    generateNewShape();
                }
                drawShape();
                renderBoard();
            }
        });

        // Rotate shape
        function rotateShape(clockwise = true) {
            const rows = currentShape.length;
            const cols = currentShape[0].length;
            const newShape = Array.from({ length: cols }, () => Array(rows).fill(0));

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (clockwise) {
                        newShape[col][rows - 1 - row] = currentShape[row][col];
                    } else {
                        newShape[rows - 1 - col][row] = currentShape[row][col];
                    }
                }
            }

            currentShape = newShape;
        }

        // Trigger question
        function triggerQuestion() {
            clearInterval(gameInterval);
            gamePaused = true;
            document.getElementById('question-area').style.display = 'block';
            document.getElementById('game-container').style.display = 'none';

            let questions;
            if (roles[currentPlayer - 1] === 'Technologist') {
                questions = technologistQuestions;
            } else if (roles[currentPlayer - 1] === 'Ethics Advisor') {
                questions = ethicsAdvisorQuestions;
            } else if (roles[currentPlayer - 1] === 'Principal') {
                questions = principalQuestions;
            }

            console.log("Current player role:", roles[currentPlayer - 1]);
            console.log("Questions array:", questions);

            // 根据分数确定当前级别
            if (scores[currentPlayer - 1] >= 200) {
                currentLevel = 3;
            } else if (scores[currentPlayer - 1] >= 100) {
                currentLevel = 2;
            } else if (scores[currentPlayer - 1] < 100) {
                currentLevel = 1;
            }

            console.log("Current level:", currentLevel);

            const questionSet = questions[currentLevel - 1];
            console.log("Question set:", questionSet);

            let selectedQuestion;
            let attempts = 0;
            const maxAttempts = questionSet.length;

            // 尝试找到一个未问过的问题
            do {
                const randomIndex = Math.floor(Math.random() * questionSet.length);
                selectedQuestion = questionSet[randomIndex];
                attempts++;
                if (attempts >= maxAttempts) {
                    // 如果所有问题都问过了，重置已问问题集合
                    askedQuestions.clear();
                    break;
                }
            } while (askedQuestions.has(selectedQuestion.question));

            console.log("Selected question:", selectedQuestion);

            // 将这个问题添加到已问问题集合中
            askedQuestions.add(selectedQuestion.question);

            document.getElementById('question-text').innerText = selectedQuestion.question;
            
            const answerButtons = document.querySelectorAll('#question-area button');
            for (let i = 0; i < selectedQuestion.options.length; i++) {
                answerButtons[i].innerText = selectedQuestion.options[i];
                answerButtons[i].style.display = 'block';
                answerButtons[i].onclick = function() {
                    clearTimeout(questionTimer);
                    answerQuestion(this.innerText === selectedQuestion.answer);
                };
            }

            currentQuestionStartTime = Date.now();
            questionTimer = setTimeout(() => {
                answerQuestion(false);
            }, 30000);

            console.log("Question triggered:", selectedQuestion.question);

            shouldTriggerQuestion = false; // 重置标志
        }

        // Answer question
        function answerQuestion(correct) {
            document.getElementById('question-area').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            let scoreIncrement;
            if (currentLevel === 1) {
                scoreIncrement = correct ? 10 : 0;
            } else if (currentLevel === 2) {
                scoreIncrement = correct ? 20 : 0;
            } else if (currentLevel === 3) {
                scoreIncrement = correct ? 30 : 0;
            }
            
            scores[currentPlayer - 1] += scoreIncrement;
            document.getElementById(`score-player-${currentPlayer}`).innerText = `玩家 ${currentPlayer}: ${scores[currentPlayer - 1]}`;
            
            if (!correct || Date.now() - currentQuestionStartTime >= 30000) {
                dropSpeed = Math.max(100, dropSpeed - 50); // 加快下落速度，但不低于100ms
            }
            
            if (playerCount === 2) {
                currentPlayer = currentPlayer === 1 ? 2 : 1;
            }
            gamePaused = false;
            generateNewShape(); // 确保在回答问题后生成新的方块
            gameInterval = setInterval(dropShape, dropSpeed);
            console.log("Question answered, game resumed");
        }

        function checkAndTriggerQuestion() {
            if (questionQueue.length > 0) {
                let triggerReason = questionQueue.shift();
                console.log("触发问题，原因：", triggerReason);
                triggerQuestion(triggerReason);
                return true;
            }
            return false;
        }

        function updateTimer() {
            const timeLeft = 30 - Math.floor((Date.now() - currentQuestionStartTime) / 1000);
            document.getElementById('timer').innerText = timeLeft;
            if (timeLeft > 0) {
                requestAnimationFrame(updateTimer);
            }
        }
    </script>
</body>
</html>